---
title:  "IO"
excerpt: "Input Output"
categories: Java
tag: [IO]
toc: true
toc_label: "목록"
toc_icon: "bars"
toc_sticky: true
---

# File
{: .notice--warning .text-center}

```java
// 파일 여는 방법
// File 변수명 = new File(경로);
File file1 = new File("./test.txt"); // 상대 경로로 열기
File file2 = new File("D:\\folder\\test.txt"); // 절대 경로로 열기

// 파일의 경로 얻는법
file1.getPath(); // ./test.txt
file1.getAbsolutePath() // D:\folder\test.txt", 상대 경로로 연 파일을 절대 경로로 얻는법

// 파일의 상위 폴더 경로 얻는법
file1.getParent(); // 상대 경로는 불가능
file2.getParent(); // D:\folder

// 권한 확인
file1.canRead();    // r, 읽기
file1.canWrite();   // w, 쓰기
file1.canExecute(); // x, 실행

// 권한 설정 (윈도우+자바는 쓰기 권한만 설정 가능)
file1.setWritable(false); // 쓰기 권한을 차단해 읽기 전용으로 만듦

// 수정된 시간 확인(사용 이력)
SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
sdf.format(file1.lastModified());

// 파일 길이 확인
file1.length();                     // byte
file1.length() / 1024;              // kbyte
file1.length() / 1024.0 / 1024.0;   // Mbyte

// 디렉토리 관련
File folder = new File("./");
folder.isDirectory(); // true, 디렉토리인지 확인
System.out.println(Arrays.toString(folder.listFiles())); // 해당 디렉토리 하위의 폴더+파일 출력

// 파일 이름 변경
File file = new File("./test2.txt");
file1.renameTo(file);

// 파일 삭제
file.delete();
```

# 파일 복사
{: .notice--warning .text-center}

- 자바7 버전 부터는 Try-catch resource문법으로 리소스를 자동으로 닫아주기 때문에 명시적으로 close메서드를 호출하지 않아도 됩니다. Closeable(AutoCloseable)을 구현한 객체에서 사용 가능합니다.

```java
public static void main(String[] args) {
	File source = new File("./test.txt");
	
	long start = System.currentTimeMillis();
	int count = 0;
	while(count++ < 100) {
		fileCopyStreamVer(source, new File("testA"+count+".txt"));
	}
	long end = System.currentTimeMillis();
	
	long estimated = end - start;
	System.out.println("fileCopyStreamVer estimated : " + estimated);
	
	start = System.currentTimeMillis();
	count = 0;
	while(count++ < 100) {
		fileCopyBufferdStreamVer(source, new File("testB"+count+".txt"));
	}
	end = System.currentTimeMillis();
	
	estimated = end - start;
	System.out.println("fileCopyBufferdStreamVer estimated : " + estimated);

    // 성능 차이, Buffered를 쓰면 성능이 비약적으로 향상
    // fileCopyStreamVer estimated : 10000
    // fileCopyBufferdStreamVer estimated : 100
}
```

## 방법 1. Stream
{: .notice--success .text-center}

```java
// 1byte씩 복사하는 고전적인 방법(매우 느림)
// Stream은 binary 파일을 다룰 때 사용, 완벽하게 원본을 복사함
// Reader, Writer는 문자열을 다룰 때 사용, FileInputStream, FileOutputStream를 FileReader, FileWriter로 대체할 경우 인코딩이 맞지 않으면 복사가 제대로 되지 않음
public static int fileCopyStreamVer(File src, File dest) {
	int size = 0; // 파일 사이즈
	try (FileInputStream fis = new FileInputStream(src); 
		 FileOutputStream fos = new FileOutputStream(dest);) {
		int read = 0;
		while((read = fis.read()) != -1 ) {
			fos.write(read);
			size++;
		}
	} catch (Exception e) {
		e.printStackTrace();
		return -1; // 에러 설계, -1 반환
	}
	return size;
}
```

## 방법 2. Stream + Buffered
{: .notice--success .text-center}

```java
public static int fileCopyBufferdStreamVer(File src, File dest) {
	int size = 0;
	try	(FileInputStream fis = new FileInputStream(src);
		 FileOutputStream fos = new FileOutputStream(dest);
		 BufferedInputStream bis = new BufferedInputStream(fis);
		 BufferedOutputStream bos = new BufferedOutputStream(fos);)
	{
		int read = 0;
		while((read = bis.read()) != -1) {
			bos.write(read);
		}
	} catch (Exception e) {
		e.printStackTrace();
		return -1;
	} 
	return size;
}
```

```java
// try-catch-resource를 활용하지 않고 close를 작성했을 때
public static int fileCopyBufferdStreamOldVer(File src, File dest) {
	int size = 0;
	FileInputStream fis = null;
	FileOutputStream fos = null;
	BufferedInputStream bis = null;
	BufferedOutputStream bos = null;
	try {
		// open부
		fis = new FileInputStream(src);
		fos = new FileOutputStream(dest);
		bis = new BufferedInputStream(fis);
		bos = new BufferedOutputStream(fos);	
		int read = 0;
		while((read = bis.read()) != -1) {
			bos.write(read);
		}
	} catch (Exception e) {
		e.printStackTrace();
		return -1;
	} finally {
		// close부는 열린순서의 역순으로 닫음
		if (bos != null) {
			try { bos.close(); }
			catch (IOException e) { e.printStackTrace(); }
		}
		if (bis != null) {
			try { bis.close(); }
			catch (IOException e) { e.printStackTrace(); }
		}
		if (fos != null) {
			try { fos.close(); }
			catch (IOException e) { e.printStackTrace(); }
		}
		if (fis != null) {
			try { fis.close(); }
			catch (IOException e) { e.printStackTrace(); }
		}
	}
	return size;
}
```

## 방법 3. Reader, Writer + Buffered
{: .notice--success .text-center}

```java
public static int fileCopyBufferdReadWriteVer(File src, File dest) {
	int readLineCount = 0;
	try(FileReader fr = new FileReader(src);
		FileWriter fw = new FileWriter(dest);
	    BufferedReader br = new BufferedReader(fr);
		BufferedWriter bw = new BufferedWriter(fw);)
	{
		String readLine = null;
		while((readLine = br.readLine()) != null ) {
			bw.append(readLine);
			bw.newLine();
			readLineCount++;
		}
	} catch (Exception e) {
		e.printStackTrace();
		return -1;
	}
	return readLineCount;
}
```